<!DOCTYPE html>

<html>
<head>
  <title>stagapp</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="stagapp">stagapp</h1>
<h2 id="data-handler-for-clinical-recording-of-sensortag-data">data handler for clinical recording of SensorTag data</h2>
<p>SensorTag object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> sensortag = evothings.tisensortag.createInstance();
  <span class="hljs-keyword">var</span> recording = <span class="hljs-literal">false</span>,
   connected=<span class="hljs-literal">false</span>,
   reading,
   readings,
   calibrating=<span class="hljs-literal">false</span>,
   calibrate=<span class="hljs-literal">false</span>;
   
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearUserInterface</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Clear current values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> blank = <span class="hljs-string">'[Waiting for value]'</span>;
    $(<span class="hljs-string">'#StatusData'</span>).html(<span class="hljs-string">'Ready to connect'</span>);
    $(<span class="hljs-string">'#FirmwareData'</span>).html(<span class="hljs-string">'?'</span>);
    $(<span class="hljs-string">'#KeypressData'</span>).html(<span class="hljs-string">''</span>);
    $(<span class="hljs-string">'#AccelerometerData'</span>).html(blank);
    $(<span class="hljs-string">'#MagnetometerData'</span>).html(blank);
    $(<span class="hljs-string">'#GyroscopeData'</span>).html(blank);
    $(<span class="hljs-string">'#TotalReadings'</span>).html( <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Reset screen color.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setBackgroundColor(<span class="hljs-string">'white'</span>);
    $(<span class="hljs-string">":button"</span>).prop(<span class="hljs-string">"disabled"</span>,<span class="hljs-literal">true</span>);
    $(<span class="hljs-string">"#stop"</span>).click(stopRecording);
    $(<span class="hljs-string">"#record"</span>).click(enterRecording).fadeTo(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).text(<span class="hljs-string">'record'</span>);
    
    $(<span class="hljs-string">"#reset"</span>).prop(<span class="hljs-string">"disabled"</span>,<span class="hljs-literal">false</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countReadings</span><span class="hljs-params">()</span></span>{
    $(<span class="hljs-string">'#TotalReadings'</span>).html(readings.length);
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initDataStructures</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> rtemp; 
    reading = Backbone.Model.extend(
      {defaults:{sensor:<span class="hljs-string">'gyro'</span>,x:<span class="hljs-number">0</span>,y:<span class="hljs-number">0</span>,z:<span class="hljs-number">0</span>},
       initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> d= <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(); 
                  <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'time'</span>,d.getTime())}
      });
     
    rtemp = Backbone.Collection.extend(
      {
        model:<span class="hljs-string">'reading'</span>,
        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'add'</span>,countReadings);
          <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'remove'</span>,countReadings);
          <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'reset'</span>,countReadings);
        }
      });

    readings = <span class="hljs-keyword">new</span> rtemp();
    $(<span class="hljs-string">'#TotalReadings'</span>).html( <span class="hljs-string">'0'</span>);
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initAll</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> rtemp; 
    clearUserInterface();
    initDataStructures();
  }
    
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialiseSensorTag</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Here sensors are set up.</p>
<p>If you wish to use only one or a few sensors, just set up
the ones you wish to use.</p>
<p>First parameter to sensor function is the callback function.
Several of the sensors take a millisecond update interval
as the second parameter.
Gyroscope takes the axes to enable as the third parameter:
1 to enable X axis only, 2 to enable Y axis only, 3 = X and Y,
4 = Z only, 5 = X and Z, 6 = Y and Z, 7 = X, Y and Z.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    connected = <span class="hljs-literal">false</span>;
    sensortag
      .statusCallback(statusHandler)
      .errorCallback(errorHandler)
      .keypressCallback(keypressHandler)
      .accelerometerCallback(accelerometerHandler, <span class="hljs-number">100</span>)
      .magnetometerCallback(magnetometerHandler, <span class="hljs-number">100</span>)
      .gyroscopeCallback(gyroscopeHandler, <span class="hljs-number">100</span>, <span class="hljs-number">7</span>) <span class="hljs-comment">// 7 = enable all axes.</span>
      .connectToClosestDevice();
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterReset</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>legal to enter Reset from any state </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reading = <span class="hljs-literal">false</span>;
    readings = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>sensortag.disconnectDevice();
sensortag = evothings.tisensortag.createInstance();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    recording=<span class="hljs-literal">false</span>;
    initDataStructures();
    enterConnected();
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterConnected</span><span class="hljs-params">()</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>enable the recording button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    connected = <span class="hljs-literal">true</span>;
    $(<span class="hljs-string">"#record"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">false</span>).fadeTo(<span class="hljs-number">100</span>,<span class="hljs-number">1</span>).text(<span class="hljs-string">'record'</span>).click(enterRecording);
    $(<span class="hljs-string">"#stop"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    $(<span class="hljs-string">"#upload"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    $(<span class="hljs-string">"#calibrate"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterCalibrating</span><span class="hljs-params">()</span></span>{
    $(<span class="hljs-string">"#record"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    $(<span class="hljs-string">"#stop"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    $(<span class="hljs-string">"#upload"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    calibrating=<span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterRecording</span><span class="hljs-params">()</span></span>{
    $(<span class="hljs-string">"#record"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>).text(<span class="hljs-string">'recording'</span>).fadeTo(<span class="hljs-number">200</span>,<span class="hljs-number">0.6</span>);
    $(<span class="hljs-string">"#stop"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">false</span>).fadeTo(<span class="hljs-number">100</span>,<span class="hljs-number">1</span>).click(enterReview);
    $(<span class="hljs-string">"#upload"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>);
    recording=<span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterReview</span><span class="hljs-params">()</span></span>{
    $(<span class="hljs-string">"#stop"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>).fadeTo(<span class="hljs-number">100</span>,<span class="hljs-number">0.5</span>);
    $(<span class="hljs-string">"#record"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>).text(<span class="hljs-string">'recorded'</span>).fadeTo(<span class="hljs-number">200</span>,<span class="hljs-number">0.3</span>);
    $(<span class="hljs-string">"#upload"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">false</span>).click(enterUpload).fadeTo(<span class="hljs-number">100</span>,<span class="hljs-number">1</span>)
   recording=<span class="hljs-literal">false</span>;	
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterUpload</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> hopper,brainDump;
    <span class="hljs-comment">/* eliminate empty uploads per : https://github.com/jahbini/stagapp/issues/15 */</span>
    <span class="hljs-keyword">if</span>(!readings.length) <span class="hljs-keyword">return</span>;
    hopper = Backbone.Model.extend({url:<span class="hljs-string">"/trajectory"</span>});
    brainDump = <span class="hljs-keyword">new</span> hopper({readings: readings});
    brainDump.save();
    readings.reset();
    enterConnected();
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">statusHandler</span><span class="hljs-params">(status)</span></span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'Sensors online'</span> == status){
      enterConnected();
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'Device data available'</span> == status){
      $(<span class="hljs-string">'#FirmwareData'</span>).html(sensortag.getFirmwareString());
    }
    $(<span class="hljs-string">'#StatusData'</span>).html(status);
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorHandler</span><span class="hljs-params">(error)</span></span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: '</span> + error)
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'disconnected'</span> == error){
      connected = <span class="hljs-literal">false</span>;
      clearUserInterface();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>If disconneted attempt to connect again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      setTimeout(
        <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ sensortag.connectToClosestDevice() },
        <span class="hljs-number">1000</span>)
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>calculations implemented as based on TI wiki pages
<a href="http://processors.wiki.ti.com/index.php/SensorTag_User_Guide">http://processors.wiki.ti.com/index.php/SensorTag_User_Guide</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keypressHandler</span><span class="hljs-params">(data)</span></span>{
    <span class="hljs-keyword">var</span> left=<span class="hljs-number">0</span>,right=<span class="hljs-number">0</span>,string;
    
    <span class="hljs-keyword">switch</span> (data[<span class="hljs-number">0</span>]){
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        string = <span class="hljs-string">"          "</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        string = <span class="hljs-string">"     right"</span>;
        right=<span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
        string = <span class="hljs-string">"left      "</span>;
        left=<span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        right=<span class="hljs-number">1</span>;
        left=<span class="hljs-number">1</span>;
        string = <span class="hljs-string">"   both   "</span>;
        <span class="hljs-keyword">break</span>;
    }
    calibrate = (left &amp;&amp; calibrating);
    <span class="hljs-keyword">if</span>(recording) readings.push( <span class="hljs-keyword">new</span> reading({sensor:<span class="hljs-string">'button'</span>,left:left,right:right}));</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Update the value displayed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'KeypressData'</span>).html(string);
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">templater</span><span class="hljs-params">(x,y,z,sensor,unit)</span></span>{
      <span class="hljs-keyword">return</span>  sensor+ <span class="hljs-string">' x='</span> + (x &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + x.toFixed(<span class="hljs-number">3</span>) + unit +<span class="hljs-string">' -- '</span>
      + <span class="hljs-string">'y='</span> + (y &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + y.toFixed(<span class="hljs-number">3</span>) + unit + <span class="hljs-string">' -- '</span>
      + <span class="hljs-string">'z='</span> + (z &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + z.toFixed(<span class="hljs-number">3</span>) + unit;
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pointFormat</span><span class="hljs-params">(p,unit,precision)</span></span>{
      <span class="hljs-keyword">if</span>(!precision) precision = <span class="hljs-number">3</span>;
      <span class="hljs-keyword">if</span>(!unit) unit = <span class="hljs-string">'v'</span>;
      <span class="hljs-keyword">return</span>  <span class="hljs-string">' x='</span> + (p.x &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + p.x.toFixed(precision) + unit +<span class="hljs-string">' -- '</span>
      + <span class="hljs-string">'y='</span> + (p.y &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + p.y.toFixed(precision) + unit + <span class="hljs-string">' -- '</span>
      + <span class="hljs-string">'z='</span> + (p.z &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + p.z.toFixed(precision) + unit;
  }
 
 <span class="hljs-keyword">var</span> accelerometerHandler = readingHandler(
   {sensor:<span class="hljs-string">'accel'</span>,
    source:sensortag.getAccelerometerValues,
    units:<span class="hljs-string">'G'</span>,
    viewer:viewSensor(<span class="hljs-string">'accel-view'</span>,<span class="hljs-number">0.8</span>),
    htmlID:<span class="hljs-string">'AccelerometerData'</span>}
    );
 <span class="hljs-keyword">var</span> magnetometerHandler = readingHandler(
   { sensor:<span class="hljs-string">'mag'</span>,
     source:sensortag.getMagnetometerValues,
     units:<span class="hljs-string">'&amp;micro;T'</span>,
     viewer:viewSensor(<span class="hljs-string">'magnet-view'</span>,<span class="hljs-number">1</span>),
     htmlID:<span class="hljs-string">'MagnetometerData'</span>}
     );
 <span class="hljs-keyword">var</span> gyroscopeHandler = readingHandler(
   {sensor:<span class="hljs-string">'gyro'</span>,
    source:sensortag.getGyroscopeValues,
    viewer:viewSensor(<span class="hljs-string">'gyro-view'</span>,<span class="hljs-number">1</span>),
    htmlID:<span class="hljs-string">'GyroscopeData'</span>
   }
   );</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1 id="-readinghandler-">## readingHandler()</h1>
<h1 id="create-and-return-a-function-to-handle-a-sensor-s-new-data">create and return a function to handle a sensor’s new data</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readingHandler</span><span class="hljs-params">(o)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if there is no calibration function, just use a null offset</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!o.calibrator) o.calibrator = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> seen.P(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)};
    <span class="hljs-keyword">if</span>(!o.units) o.units = <span class="hljs-string">''</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>data points from Evothings library are seen.Point NOT compatible as sources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> r=o.source(data); 
      <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> seen.P(r.x,r.y,r.z); 
      p.subtract(o.calibrator());
      <span class="hljs-keyword">if</span>(recording) readings.push(
        <span class="hljs-keyword">new</span> reading({sensor:o.sensor,x:p.x,y:p.y,z:p.z,raw:_.toArray(data)})
        );
      $(o.htmlID).html(templater(p.x,p.y,p.z,o.sensor,o.units) );
      o.viewer(p.x,p.y,p.z);
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setBackgroundColor</span><span class="hljs-params">(color)</span>
  </span>{
    <span class="hljs-built_in">document</span>.documentElement.style.background = color
    <span class="hljs-built_in">document</span>.body.style.background = color
  }

  <span class="hljs-comment">/**
   * Convert byte buffer to hex string.
   * @param buffer - an Uint8Array
   * @param offset - byte offset
   * @param numBytes - number of bytes to read
   * @return string with hex representation of bytes
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bufferToHexStr</span><span class="hljs-params">(buffer, offset, numBytes)</span>
  </span>{
    <span class="hljs-keyword">var</span> hex = <span class="hljs-string">''</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; numBytes; ++i)
    {
      hex += byteToHexStr(buffer[offset + i])
    }
    <span class="hljs-keyword">return</span> hex
  }

  <span class="hljs-comment">/**
   * Convert byte number to hex string.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">byteToHexStr</span><span class="hljs-params">(d)</span>
  </span>{
    <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">0</span>) { d = <span class="hljs-number">0xFF</span> + d + <span class="hljs-number">1</span> }
    <span class="hljs-keyword">var</span> hex = <span class="hljs-built_in">Number</span>(d).toString(<span class="hljs-number">16</span>)
    <span class="hljs-keyword">var</span> padding = <span class="hljs-number">2</span>
    <span class="hljs-keyword">while</span> (hex.length &lt; padding)
    {
      hex = <span class="hljs-string">'0'</span> + hex
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="stoprecording">stopRecording</h2>
<p>halt the record session — no restart allowed
upload button remains enabled, reset button remains enabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopRecording</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">if</span> (recording) {
      recording = <span class="hljs-literal">false</span>;
    $(<span class="hljs-string">"#record"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">true</span>).text(<span class="hljs-string">'finished'</span>).fadeTo(<span class="hljs-number">200</span>,<span class="hljs-number">0.3</span>);
    }
  }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewSensor</span><span class="hljs-params">(viewport,scaleFactor)</span></span>{
  <span class="hljs-keyword">var</span> height = <span class="hljs-number">200</span>, width = <span class="hljs-number">200</span>,
    model = seen.Models[<span class="hljs-string">"default"</span>](),
    scene = <span class="hljs-keyword">new</span> seen.Scene({ model: model, viewport: seen.Viewports.center(width, height) }),
    context = seen.Context(viewport, scene),
    cubie = seen.Shapes.cube().scale(<span class="hljs-number">0.25</span>),
    spearFromPool = <span class="hljs-keyword">new</span> spearPool(<span class="hljs-number">10</span>);
    
    cubie.fill( <span class="hljs-keyword">new</span> seen.Material (<span class="hljs-keyword">new</span> seen.Color(<span class="hljs-number">25</span>,<span class="hljs-number">200</span>,<span class="hljs-number">200</span>,<span class="hljs-number">100</span>)));
    model.add(cubie);
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spearPool</span><span class="hljs-params">(many)</span></span>{
    <span class="hljs-keyword">var</span> i,j,shapes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(many),count=-<span class="hljs-number">1</span>,colors=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(many);
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt; many;i++) {
      shapes[i] = seen.Shapes.arrow(<span class="hljs-number">1</span>,<span class="hljs-number">18</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>).scale(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>).translate(<span class="hljs-number">20</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>).scale(height * <span class="hljs-number">0.025</span>);
      shapes[i].bake();
      colors[i] = <span class="hljs-keyword">new</span> seen.Material (<span class="hljs-keyword">new</span> seen.Color(<span class="hljs-number">255</span>,<span class="hljs-number">80</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>-(<span class="hljs-number">250</span>/many)*i));
    }
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newArrow</span><span class="hljs-params">(model,x,y,z)</span></span>{
      <span class="hljs-keyword">var</span> alphaDecay=<span class="hljs-number">255</span>;
      count = count+<span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span>(count == many) count=<span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">if</span> (shapes[count]) model.remove(shapes[count]);
      shapes[count] = seen.Shapes.arrow(<span class="hljs-number">1</span>,<span class="hljs-number">18</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>).scale(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>).translate(<span class="hljs-number">20</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>).scale(height * <span class="hljs-number">0.025</span>),
      model.add(shapes[count]);
      shapes[count].bake(); 
      shapes[count].reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>assign alpha to the arrows color</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      j=<span class="hljs-number">0</span>; 
      <span class="hljs-keyword">for</span> (i= count; i&lt;many;i++){
        <span class="hljs-keyword">if</span>(shapes[i])
          shapes[i].fill( colors[j++]);
      }
      <span class="hljs-keyword">for</span> (i= <span class="hljs-number">0</span>; i&lt;count;i++){
        <span class="hljs-keyword">if</span>(shapes[i])
          shapes[i].fill( colors[j++]);
      }
      <span class="hljs-keyword">return</span> shapes[count]; 
    }
   <span class="hljs-keyword">return</span> newArrow; 
  }
  
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newValue</span><span class="hljs-params">(x,y,z)</span></span>{
    <span class="hljs-keyword">var</span> p1=seen.P(x,y,z),spear,pOriginal = p1.copy(),pBar=seen.P(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),m,q,
     cross,dot,
    leng = p1.magnitude();
    p1=p1.normalize();
    
    pBar.add(p1);
    
    <span class="hljs-keyword">if</span> (pBar.magnitude() &lt; <span class="hljs-number">0.000001</span>) {
      <span class="hljs-comment">/* this is a 180 degree rotation, so use y axis as rotation vector */</span>
      pBar=seen.P(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);  
    }
    
    pBar.normalize();
    q=seen.Quaternion.pointAngle(pBar,<span class="hljs-built_in">Math</span>.PI);
    
    m=q.toMatrix();
    spear = spearFromPool(model,x,y,z).transform(m).scale(scaleFactor);
    spear.fill( <span class="hljs-keyword">new</span> seen.Material (<span class="hljs-keyword">new</span> seen.Color(<span class="hljs-number">255</span>,<span class="hljs-number">80</span>,<span class="hljs-number">255</span>)));
    context.render();
  }
  <span class="hljs-keyword">return</span> newValue;
}

<span class="hljs-comment">/*
viewGyro(0,10,0);
viewGyro(0,-5,0);
viewGyro(0,0,10);
viewGyro(0,0,-5);
viewGyro(5,5,5);
viewGyro(0,5,5);
viewGyro(5,0,5);
viewGyro(5,5,0);
viewAccel(-0.5,0.6,0.7);

viewMagnet(10.5,0.6,-0.7);
viewMagnet(10.4,0.6,-0.8);
viewMagnet(10.4,2.6,-0.8);
viewMagnet(10.4,5.6,-0.8);
viewMagnet(10.3,0.6,-0.2);

viewGyro(10,0,0);
viewGyro(-5,0,0);
*/</span>

$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  initAll();
  $(<span class="hljs-string">"#reset"</span>).prop(<span class="hljs-string">'disabled'</span>,<span class="hljs-literal">false</span>).fadeTo(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).click(enterReset);
  $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'deviceready'</span>, initialiseSensorTag );
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
